<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HBD love</title>

<link rel="stylesheet" href="default.css">

<script src="jquery.min.js"></script>
<script src="jscex.min.js"></script>
<script src="jscex-parser.js"></script>
<script src="jscex-jit.js"></script>
<script src="jscex-builderbase.min.js"></script>
<script src="jscex-async.min.js"></script>
<script src="jscex-async-powerpack.min.js"></script>
<script src="function.js"></script>
<script src="love.js"></script>

<script>
function playAudio() {
  var audio = document.getElementById("myAudio");
  if (audio && audio.paused) {
    audio.play().catch(function(){});
  }
}
</script>
</head>

<body>
<div id="main">

<audio id="myAudio" preload="auto">
  <source src="aud.mp3" type="audio/mpeg">
</audio>

<div id="wrap">
  <div id="text">
    <div id="code">
      <span class="say">Hey you üíû</span><br>
      <span class="say">Happy Birthday üéà</span><br>
      <span class="say">May God bless you üçÄ</span><br>
      <span class="say">And give u many happiness üíï</span><br>
      <span class="say">Just saying... you're pretty awesome ‚ù§Ô∏è</span><br>
      <span class="say">Hope u have a great day ‚ù§Ô∏èüòò</span><br>
    </div>
  </div>

  <canvas id="canvas" width="1100" height="680"></canvas>
</div>
</div>

<script>
(function () {

var canvas = $("#canvas");
if (!canvas[0].getContext) return;

var width = canvas.width();
var height = canvas.height();
canvas.attr("width", width);
canvas.attr("height", height);

/* ‚úÖ HYBRID TREE CONFIG
   - full branch data (no black screen)
   - but animation speed tuned for clean look
*/
var opts = {
  seed: {
    x: width / 2 - 20,
    color: "rgb(190,26,37)",
    scale: 2
  },
  branch: [
    [535,680,570,250,500,200,30,100,[
      [540,500,455,417,340,400,13,100],
      [550,445,600,356,680,345,12,100],
      [539,281,537,248,534,217,3,40],
      [546,397,413,247,328,244,9,80],
      [546,357,608,252,678,221,6,100]
    ]]
  ],
  bloom: {
    num: 650,          // thoda kam = clean heart
    width: 1080,
    height: 650
  },
  footer: {
    width: 1200,
    height: 5,
    speed: 10
  }
};

var tree = new Tree(canvas[0], width, height, opts);
var seed = tree.seed;
var foot = tree.footer;
var hold = 1;

/* CLICK TO START */
canvas.on("click", function(e){
  playAudio();
  var o = canvas.offset();
  var x = e.pageX - o.left;
  var y = e.pageY - o.top;
  if (seed.hover(x, y)) {
    hold = 0;
    canvas.off("click mousemove");
  }
}).on("mousemove", function(e){
  var o = canvas.offset();
  canvas.toggleClass(
    "hand",
    seed.hover(e.pageX - o.left, e.pageY - o.top)
  );
});

/* SEED */
var seedAnimate = eval(Jscex.compile("async", function () {
  seed.draw();
  while (hold) {
    $await(Jscex.Async.sleep(10));
  }
  while (seed.canScale()) {
    seed.scale(0.95);
    $await(Jscex.Async.sleep(10));
  }
  while (seed.canMove()) {
    seed.move(0, 2);
    foot.draw();
    $await(Jscex.Async.sleep(10));
  }
}));

/* TREE */
var growAnimate = eval(Jscex.compile("async", function () {
  while (tree.canGrow()) {
    tree.grow();
    $await(Jscex.Async.sleep(10));
  }
}));

/* FLOWERS */
var flowAnimate = eval(Jscex.compile("async", function () {
  while (tree.canFlower()) {
    tree.flower(2);
    $await(Jscex.Async.sleep(10));
  }
}));

/* FINAL PNG SNAPSHOT */
var finalSnapshot = eval(Jscex.compile("async", function () {
  $await(Jscex.Async.sleep(400));
  canvas.parent().css(
    "background",
    "url(" + tree.toDataURL("image/png") + ") center/contain no-repeat"
  );
}));

/* TEXT */
var textAnimate = eval(Jscex.compile("async", function () {
  $("#code").show().typewriter();
}));

/* RUN ORDER */
var runAsync = eval(Jscex.compile("async", function () {
  $await(seedAnimate());
  $await(growAnimate());
  $await(flowAnimate());
  $await(finalSnapshot());
  textAnimate().start();
}));

runAsync().start();

})();
</script>

</body>
</html>
